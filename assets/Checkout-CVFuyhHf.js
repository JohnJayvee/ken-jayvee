import{r as n,C as b,U as v,a as S,j as e}from"./index-BgBV79IB.js";import{M}from"./Modal-49kcBvkV.js";import{I as u}from"./InputBlock-CH_l02eA.js";import{B as j}from"./Button-ByKht_eV.js";import{a as q}from"./axios-B4uVmeYG.js";function T(){const i=n.useContext(b),p=n.useContext(v),{user:o}=S(),[y,d]=n.useState(!1),[t,c]=n.useState({}),x=i.items.reduce((a,s)=>a+s.quantity*s.price,0),[r,m]=n.useState({firstName:o?o.name:"",lastName:o?o.name:"",email:"",cellphoneNumber:"",address:"",message:"",paymentMethod:"cash on delivery",user_id:o?o.id:"",orders:i.items.map(a=>({product_id:a.id,quantity:a.quantity,totalPrice:x}))}),f=i.items;n.useEffect(()=>{m(a=>({...a,orders:i.items.map(s=>({product_id:s.id,quantity:s.quantity,totalPrice:s.quantity*s.price}))}))},[f]);const l=a=>{const{name:s,value:h}=a.target;m(N=>({...N,[s]:h}))},C=async a=>{if(a.preventDefault(),d(!0),r.orders.length===0){c(s=>({...s,orders:["The orders field is required."]})),d(!1);return}try{const s=await q.post("http://white-emu-581912.hostingersite.com/api/order/create",r,{headers:{"Content-Type":"application/json"}});console.log("Order submitted successfully:",s.data),m(h=>({...h,message:""})),c({}),window.location.reload()}catch(s){s.response&&s.response.status===422?(c(s.response.data.errors),console.log(r)):console.error("Error submitting form:",s)}finally{d(!1)}};let g=e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"btn-danger",type:"button",onClick:()=>p.hideCheckout(),children:"Close"}),e.jsx(j,{className:"btn-dark mx-3",type:"submit",children:"Submit Order"})]});return y&&(g=e.jsx("span",{children:"Sending order data..."})),e.jsx(M,{open:p.progress==="checkout",children:e.jsxs("form",{onSubmit:C,children:[e.jsx("h2",{children:"Checkout"}),e.jsxs("p",{className:"h2",children:["Total Amount: â‚±",x]}),e.jsx(u,{label:"Email",type:"email",id:"email",name:"email",onChange:l,value:r.email}),t.email&&e.jsx("p",{className:"error-text",children:t.email[0]}),e.jsx(u,{label:"Contact Number",type:"text",id:"cellphoneNumber",name:"cellphoneNumber",onChange:l,value:r.cellphoneNumber}),t.cellphoneNumber&&e.jsx("p",{className:"error-text",children:t.cellphoneNumber[0]}),e.jsx(u,{label:"Address",type:"text",id:"address",name:"address",onChange:l,value:r.address}),t.address&&e.jsx("p",{className:"error-text",children:t.address[0]}),e.jsx("textarea",{className:"w-50",label:"message",id:"message",name:"message",placeholder:"Note to seller",onChange:l,value:r.message}),e.jsx("div",{className:"control-row",children:e.jsxs("label",{className:"h5",children:["Payment method",e.jsxs("select",{name:"paymentMethod",id:"paymentMethod",value:r.paymentMethod,onChange:l,children:[e.jsx("option",{value:"cash on delivery",children:"Cash on Delivery"}),e.jsx("option",{value:"Gcash",children:"Gcash"})]})]})}),t.paymentMethod&&e.jsx("p",{className:"error-text",children:t.paymentMethod[0]}),t.orders&&e.jsx("p",{className:"error-text",children:t.orders[0]}),e.jsx("div",{className:"modal-actions",children:g})]})})}export{T as default};
